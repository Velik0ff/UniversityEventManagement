extends layout

block content
    script.
        function searchFilter() {
            const input = $("#searchBox").val();
            const list = !{JSON.stringify(list)};

            function filterOutResults(object) {
                return object.id.includes(input) || object.name.includes(input);
            }

            function populateList(list) {
                $("tbody").empty();

                if (list.length > 0) {
                    list.forEach(function (list_element) {
                        let tr = $("<tr>").appendTo('tbody');

                        for (let index in list_element) {
                            if (index === "id") {
                                $("<td>").attr('style', 'font-weight:bold').text(list_element[index]).appendTo(tr);
                            } else if (index === "name") {
                                let td = $("<td>").appendTo(tr);
                                $("<a>").attr('href', "#{viewLink}?id=" + list_element.id).text(list_element[index]).appendTo(td);
                            } else {
                                $("<td>").text(list_element[index]).appendTo(tr);
                            }
                        }

                        if("!{deleteLink}" !== "undefined" || "!{editLink}" !== "undefined"){
                        	let td = $("<td>").appendTo(tr);

                            if ("!{editLink}" !== "undefined") {
                                let edit_a = $("<a>")
                                    .attr("class", "options-btn")
                                    .attr("href", "#{editLink}?id=" + list_element.id)
                                    .attr("onclick", "return confirm('Are you sure you want to delete this entity?')").appendTo(td);
                                $("<i>").attr("class", "material-icons md-18").text("edit").appendTo(edit_a)
                            }
                            if("!{deleteLink}" !== "undefined"){
                            	let delete_a = $("<a>")
                                  .attr("class","options-btn")
                                  .attr("href","#{deleteLink}?id="+list_element.id)
                                  .attr("onclick","return confirm('Are you sure you want to delete this entity?')").appendTo(td);
                            	$("<i>").attr("class","material-icons md-18").text("delete").appendTo(delete_a)
                            }
                        }
                    });
                } else {
                    let tr = $("<tr>").appendTo('tbody');
                    $("<td>").attr('colspan', #{columns.length}).attr('align','center').text("No results to show").appendTo(tr);
                }
            }

            if (input !== "") {
                populateList(list.filter(filterOutResults));
            } else populateList(list);
        }

        function applyFilter(){
            $.post("../filter", {

            }, function (data) {
                $(".result").html(data);
            });
        }

    .container
        h3.title=title
        if addLink
            a.btn.btn-success(href=addLink style="margin:5px;") Add New

        button.btn.btn-link#filterBtn Filter

        p
            div.row
                div.col-sm(style="padding-right:0")
                    input.form-control#searchBox(type="text" placeholder="Search by typing name or ID..")
                div.col-sm(style="flex-grow:0;padding-left:0")
                    button.btn.btn-primary(onclick="searchFilter()") Search


        div#filter(style="display:none;")
            h5="Filter Data"
            hr

            if filter == "events"
                div#rangeSpaces
                    h6="Spaces Available"
                    div.row
                        div.col-sm
                            span="Minimum"
                            input.form-control(type="number")
                        div.col-sm
                            span="Maximum"
                            input.form-control(type="number")
                hr

                div#rangeVisitors
                    h6="Number of Visitors"
                    div.row
                        div.col-sm
                            span="Minimum"
                            input.form-control(type="number")
                        div.col-sm
                            span="Maximum"
                            input.form-control(type="number")
                hr

                div#rangeDate
                    h6="Dates"
                    div.row
                        div.col-sm
                            span="From"
                            input.form-control(type="date")
                        div.col-sm
                            span="To"
                            input.form-control(type="date")
                hr

            if filter == "equipment"
                div#rangeQuantity
                    h6="Quantity"
                    div.row
                        div.col-sm
                            span="Minimum"
                            input.form-control(type="number")
                        div.col-sm
                            span="Maximum"
                            input.form-control(type="number")
                hr

            if filter == "rooms"
                div#rangeCapacity
                    h6="Capacity"
                    div.row
                        div.col-sm
                            span="Minimum"
                            input.form-control(type="number")
                        div.col-sm
                            span="Maximum"
                            input.form-control(type="number")
                hr


            center
                button.btn.btn-primary(onclick="applyFilter()")="Apply Filter"

        table.table
            thead
                tr
                    each column in columns
                        th(scope='col')=column
            tbody
                if error
                    tr
                        td(colspan=columns.length align="center")=error
                each item in list
                    tr
                        each info,index in item
                            if index==="id"
                                td(style="font-weight:bold")=info
                            else if index==="name"
                                td
                                    a(href=viewLink+"?id="+item.id)=info
                            else
                                td=info
                        if deleteLink || editLink
                            td
                                if editLink
                                    a.options-btn(href=editLink+"?id="+item.id)
                                        i.material-icons.md-18 edit
                                if deleteLink
                                    a.options-btn(href=deleteLink+"?id="+item.id onclick="return confirm('Are you sure you want to delete this entity?')")
                                        i.material-icons.md-18 delete

    script.
        $("#filterBtn").on('click', function (event) {
            let filter_container = $("#filter");

            if (filter_container.css('display') == 'none') {
                filter_container.css('display', 'block');
            } else {
                filter_container.css('display', 'none');
            }
        });